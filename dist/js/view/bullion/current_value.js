define(["vendor/tpl!/templates/bullion/current_value.html","model/bulliontype","canvasjs"],function(a,b,c){var d=Backbone.View.extend({template:a,id:"current-value-"+this.cid,initialize:function(a){this.options=a||{},this.model=this.model||new b,this.options.bullionType&&this.model.set("bullionType",a.bullionType),this.model.fetch({cache:!0}),this.model.on("change",this.render,this)},toggleView:function(a){this.options.detailView=a,this.render()},render:function(){var a=function(a){return isNaN(a)?a:(+a>0?"+":"")+(+a).toFixed(2)+"%"},b=_.clone(this.model.attributes);if(b.detailView=this.options.detailView,b.valueBoxWidth="detail-view"===b.detailView?"col-xs-6":"col-xs-12",!$.isEmptyObject(b)&&this.inventory){var c=b.spots||{};b.spots||(c[this.options.bullionType]=b.spot),b.total=_.values(this.inventory).reduce(function(a,b){var d=b.attributes.metal,e=1.05263*b.attributes.qty*c[d].bid;return a+=isNaN(e)?0:e},0),b.total=b.total.toFixed(2)}return b.changeOverall=a(b.total?b.changeOverall||0:0),b.changeDaily=a(b.total?b.changeDaily||0:0),this.$el.html(this.template(b)),this},setInventory:function(a){this.inventory=a,this.render()},close:function(){this.remove(),this.unbind(),this.model&&this.model.unbind("change",this.modelChanged)}});return d});